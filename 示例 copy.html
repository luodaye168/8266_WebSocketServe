<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script>
        var CAN1_RX_DATA = [];

        var connection = new WebSocket('ws://192.168.4.1:81/', ['arduino']);
        connection.onopen = function () { connection.send('Connect ' + new Date()); };
        connection.onclose = function () { document.getElementById("lj").value = "连接断开"; }
        connection.onerror = function (error) {
            console.log('WebSocket Error ', error);
            document.getElementById("lj").value = "连接失败";
        };
        connection.onmessage = function (e) {
            if (e.data == "Connected")
                document.getElementById("lj").value = "连接成功";

            // 将接收到的字符串转换为16进制格式
            var hexData = '';
            for (var i = 0, j = 0; i < e.data.length; i += 2, j++) {
                var hexByte = e.data.substr(i, 2);
                CAN1_RX_DATA[j] = hexByte;
                hexData += hexByte + ' ';
            }
            for (var i = 0; i < 7; console.log(CAN1_RX_DATA[i++]));
            // 打印转换后的数据到控制台
            console.log('Server (Hex):', hexData);

            var hexStr1 = CAN1_RX_DATA[3];
            var hexStr2 = CAN1_RX_DATA[4];
            // 将16进制字符串转换为对应的整数
            var num1 = parseInt(hexStr1, 16);
            var num2 = parseInt(hexStr2, 16);
            // 进行计算
            var result = num1 * 256 + num2;

            // 输出结果，这里使用toString(10)将结果转换成十进制字符串
            document.getElementById("Server").value += result.toString(10) + "\r\n";
        };
        //发送文本框的内容
        function sendmsg() {connection.send(document.getElementById("msg").value);}
    </script>
</head>

<body>
    <input id="lj" type="button" value="连接中。。。"> <input type="button" value="清空"
        onclick="document.getElementById('Server').value = ''"><br>
    <textarea id="Server" cols="30" rows="10"></textarea><br>
    <input type="button" value="发送" onclick="sendmsg();"><input id="msg" type="text" value="01 00 0B 00 00 5A A0">
</body>

</html>